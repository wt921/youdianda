"use strict";(self["webpackChunkyoudianda"]=self["webpackChunkyoudianda"]||[]).push([[188],{8188:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"publicCenter"},[t.token?t._e():e("div",{staticClass:"unload-pub"},[e("van-empty",{attrs:{image:"error",description:"请登录"}})],1),t.token?e("div",{staticClass:"loaded-pub"},[e("van-form",{ref:"form",staticClass:"myForm"},[e("van-field",{attrs:{name:"title",label:"文章标题",placeholder:"请输入文章内容",rules:t.rules.title},model:{value:t.user.title,callback:function(e){t.$set(t.user,"title",e)},expression:"user.title"}}),e("van-field",{attrs:{readonly:"",clickable:"",name:"catename",label:"文章分类",value:t.user.catename,placeholder:"请选择分类",rules:t.rules.cateid},on:{click:function(e){t.isArticleListShow=!0}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isArticleListShow,callback:function(e){t.isArticleListShow=e},expression:"isArticleListShow"}},[e("van-picker",{attrs:{columns:t.cateList,"show-toolbar":"","value-key":"catename",title:"文章分类"},on:{confirm:t.onConfirm1,cancel:function(e){t.isArticleListShow=!1}}})],1),e("van-field",{attrs:{readonly:"",clickable:"",name:"label",label:"文章标签",value:t.user.tags,placeholder:"请选择标签",rules:t.rules.tags},on:{click:function(e){t.isArticleLabShow=!0}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isArticleLabShow,callback:function(e){t.isArticleLabShow=e},expression:"isArticleLabShow"}},[e("van-picker",{attrs:{"show-toolbar":"",title:"文章标签",columns:t.tagsList,"value-key":"tagname"},on:{confirm:t.onConfirm2,cancel:function(e){t.isArticleLabShow=!1}}})],1),e("van-field",{attrs:{name:"uploader",label:"文件上传"},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-uploader",{attrs:{multiple:"","max-size":"1024*1024*3"},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})]},proxy:!0}],null,!1,316249363)}),e("van-field",{attrs:{type:"textarea",name:"text",label:"文章正文",placeholder:"请输入文章内容",rules:t.rules.content},model:{value:t.user.content,callback:function(e){t.$set(t.user,"content",e)},expression:"user.content"}})],1),t.queryId?e("div",{staticClass:"button"},[e("van-button",{attrs:{type:"info","native-type":"button"},on:{click:function(e){return t.submit(1)}}},[t._v("存草稿")]),e("van-button",{attrs:{type:"warning","native-type":"button"},on:{click:function(e){return t.submit(2)}}},[t._v("修改文章")]),e("van-button",{attrs:{type:"danger","native-type":"button"},on:{click:t.onreset}},[t._v("重置")])],1):e("div",{staticClass:"button"},[e("van-button",{attrs:{icon:"plus",type:"primary"},on:{click:function(e){return t.submit(2)}}},[t._v("发布")]),e("van-button",{attrs:{icon:"sign",type:"info"},on:{click:function(e){return t.submit(1)}}},[t._v("存草稿")]),e("van-button",{attrs:{icon:"revoke",type:"danger"},on:{click:t.onreset}},[t._v("重置")])],1)],1):t._e()])},s=[],i=a(3822),o=a(2419),r=a(2900),l=a(8572),u={name:"PublicIndex",computed:{...(0,i.Se)(["token"])},data(){return{queryId:this.$route.query.id,isArticleListShow:!1,isArticleLabShow:!1,cateList:[],tagsList:[],rules:{title:[{required:!0,message:"请填写文章标题"}],cateid:[{required:!0,message:"请选择文章分类"}],tags:[{required:!0,message:"请选择文章标签"}],content:[{required:!0,message:"请输入文章内容"}]},user:{author:"",title:"",cateid:"",tags:"",pic:"",content:"",status:2,catename:""},fileList:[],showPicker:!1,userPic:{}}},created(){this.getIndex(),this.queryId&&this.showArticle()},methods:{async getIndex(){try{const{data:t}=await(0,o.oL)();console.log(t),this.cateList=t.data.allCate,this.tagsList=t.data.allTag}catch(t){console.log(t)}},onConfirm1(t){console.log(t),this.user.cateid=t.id,this.user.catename=t.catename,this.isArticleListShow=!1},onConfirm2(t){console.log(t),this.user.tags=t.tagname,this.isArticleLabShow=!1},onreset(){this.user="",this.fileList=[]},async showArticle(){try{const{data:t}=await(0,l.xr)({id:this.queryId});console.log(t),this.user=t.data.info,this.fileList=[{url:"http://122.51.249.55:8060/"+this.user.pic}]}catch(t){console.log(t)}},async submit(t){try{await this.$refs.form.validate(["title","catename","label","text"]);const e=this.fileList[0].file;if(console.log(e),e){let t=new FormData;t.append("file",e);const{data:a}=await(0,r.ZL)(t);console.log(a),this.user.pic=a.data.savePath}if(this.user.status=t.toString(),this.queryId){const{data:t}=await(0,r.B)(this.user);console.log(t),0===t.errno&&this.$toast.success("修改成功")}else{const{data:t}=await(0,r.mF)({...this.user});console.log(t),0===t.errno&&(this.$toast.success("发布成功"),this.user.pic="http://122.51.249.55:8060/"+t.data.savePath)}this.$router.push("/myarticle")}catch(e){console.log(e)}}}},c=u,d=a(1001),h=(0,d.Z)(c,n,s,!1,null,"0a5848ae",null),m=h.exports},8572:function(t,e,a){a.d(e,{Mh:function(){return i},vO:function(){return o},xr:function(){return s}});var n=a(4471);const s=t=>(0,n.Z)({url:"/home/index/show",method:"get",params:t}),i=t=>(0,n.Z)({url:"/user/userDataHandle",method:"get",params:t}),o=t=>(0,n.Z)({url:"/user/userDataHandle",method:"get",params:t})},2419:function(t,e,a){a.d(e,{_t:function(){return s},hD:function(){return i},oL:function(){return o}});var n=a(4471);const s=()=>(0,n.Z)({url:"/home/index/hot",method:"get"}),i=t=>(0,n.Z)({url:"/home/index/new",method:"get",params:t}),o=()=>(0,n.Z)({url:"/home/index/index",method:"get"})},2900:function(t,e,a){a.d(e,{$0:function(){return u},B:function(){return h},Je:function(){return d},Pe:function(){return c},YM:function(){return o},ZL:function(){return r},_H:function(){return i},mF:function(){return l},p8:function(){return s}});var n=a(4471);const s=()=>(0,n.Z)({url:"/home/user/getUserInfo"}),i=()=>(0,n.Z)({url:"/user/getUserInfo"}),o=t=>(0,n.Z)({url:"/user/update",method:"post",data:t}),r=t=>(0,n.Z)({url:"/home/common/upload?type=images",headers:{"Content-Type":"multipart/form-data"},method:"post",data:t}),l=t=>(0,n.Z)({url:"/user/addArticle",method:"post",data:t}),u=t=>(0,n.Z)({url:"/user/myArticle",method:"get",params:t}),c=t=>(0,n.Z)({url:"/home/user/userDataList?",method:"get",params:t}),d=t=>(0,n.Z)({url:"/home/user/delArticle",method:"get",params:t}),h=t=>(0,n.Z)({url:"/user/editArticle",method:"post",data:t})}}]);